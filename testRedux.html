<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>testRedux</title>
</head>
<body>
    <script>
        function createStore(reducer){
            let state=null;
            let listeners=[];
            const getState=()=>state;
            const subscribe=(listener)=>{
                listeners.push(listener);
                // unsubscribe
                return ()=>{
                    return listeners.filter((l)=>l!==listener);
                }
            };
            const dispatch=(action)=>{
                state=reducer(action,state);
                listeners.forEach((listener)=>{
                    listener();
                })
            };
            dispatch({});// initialize
            return{getState,subscribe,dispatch}
        }
        function reducer(action,state){
            // todo change state
            if (!state){
                return {

                }
            }
            switch (action.type) {
                case 'add_one': return {
                    ...state,
                    age:action.payload,
                };
                case 'xxx': return{}
            }
        }
        function combineReducer(reducers){
        let combineReducers={};
        return (state,action)=>{
            // Object.keys(reducers).forEach((item)=>{
            //     combineReducers[item]=reducers[item](state[item],action)
            // });
            // return combineReducers;
            // 这个地方用reduce就太牛逼了'
            return Object.keys(reducers).reduce((res,item)=>{
                res[item]=reducers[item](state[item],action);
                return res;
            },{})
        };
        }
        // action creator
        function displayBook(payload){
            return {type:'display_book',payload};
        }
        // 使用时直接用 store.displayBook(1)即可

    </script>
</body>
</html>