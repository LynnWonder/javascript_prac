<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>list</title>
</head>
<body>
当前在线人数: <span id="online"></span>
<button id="male">男生组</button> <button id="female">女生组</button>
<hr/>
组聊: <input type="text" name="" class="groupMsg"> <button class="sendGroupMsg">发起组聊</button>
<hr/>             <!--选中的option的value会自动赋值给select的value-->
对 <select id="towho" onchange="privateTo = this.value"></select>
说: <input type="text" name="" class="privateMsg"> <button class="sendPrivateMsg">发起私聊</button>
<hr/>
<div class="box">
    {{each msgs}}
    <ul>
        <li>{{$value.username}}:
            {{$value.content}}</li>
    </ul>
    {{/each}}
</div>

Dear {{username}} 您好,请说话: <textarea class="newContent"></textarea> <button class="btn">发送</button>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="list_socket.js"></script>
<script src="list.js"></script>
<script>
    var socket = io('http://localhost:3000');
    socket.on('connect', function(){
        console.info('连接上了');
        // 此时可以做登录状态，也就是同步前后端的信息
        socket.emit('login',{
            id:{{id}}
        });
    });
    socket.on('event', function(data){});
    socket.on('disconnect', function(){});
    // test
    socket.on('msg1', function(data){
        console.info(data);
    });
    socket.on('allmessage',function(data) {
        console.log(data);
    });
    document.querySelector('.btn').onclick=function(){
        var newContent=document.querySelector('.newContent').value;
        socket.emit('sendMsg',{
            newContent,
        })
    }
    // document.querySelector('.btn').onclick=function(){
    //     var xhr=new XMLHttpRequest();
    //     var newContent=document.querySelector('.newContent').value;
    //     xhr.onreadystatechange=function(){
    //         if(xhr.readyState===4){
    //             if(xhr.status===200){
    //                 // console.info(xhr.responseText);
    //                 // 转化为JSON数组 其实就是列表渲染
    //                 var arr = JSON.parse(xhr.responseText);
    //                 var html = '<ul>';
    //                 for (var i = 0; i < arr.length; i++) {
    //                     html += '<li>' + arr[i].username + ':' + arr[i].content +'</li>'
    //                 }
    //                 html += '</ul>';
    //                 document.querySelector('.box').innerHTML = html;
    //             }
    //         }
    //     };
    //     xhr.open('post','/send');
    //     // 发送post请求的时候必须修改请求消息头部，且在打开网址之后
    //     xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');
    //     xhr.send('msg='+newContent);
    // }
</script>
</body>
</html>